---
- name: Converge
  hosts: all
  become: true

  pre_tasks:
    - name: Update apt cache.
      apt:
        update_cache: true
        cache_valid_time: 600
      when: ansible_os_family == 'Debian'
  
  roles:
    - role: ansible-role-atlantis
      atlantis_domain: 23.21.24.224.xip.io
      atlantis_url: https://23.21.24.224.xip.io
      atlantis_gh_user: ringanta
      atlantis_gh_token: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        61663135643136313132373534393964636336326336383262306162633865613630646535636332
        3565623335323864346538656437353465343033326435300a336338636266633965386632636464
        36376264393465636138356632346138393833663330636333386463383939323931396330316239
        3138306264663561660a643430626364356665343231303966623937353837343363336366396562
        63313338333431636530633966356362346337373633323762663366393639393064656565313361
        3237386534333532643364316463306538356530616332333366
      atlantis_gh_webhook_secret: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        63323332663431333538636335366233626362366236623032653765626661386362633335373463
        6163613039333562656433346636623638626539636430330a333062346535356135393763336662
        30313966386134653032616661643166366538316166393363633736343736656161343636666534
        6439663833633736390a376532343165343333323534386434363331343539306566623136376564
        31306362656535353463633565356361366531336138633866333130393461316438
      atlantis_repo_allowlist: github.com/ringanta-demo-atlantis/*
      oauth2_proxy_cookie_secret: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        63383034646464653030303634636532343835303637323638323231323235373937326135646639
        3537386439616338646337313430616364346463343861380a646462386466616235666662616433
        30383863343866666563333638656539313932353432303033356665333335613535336439353631
        6132306238373033380a356338646633653361316265393164653839363433333932613236313534
        66323161663332313466353232343264643265323565323861346430643637333036383763313233
        6563333931346637306333633130323539383739336663383838
      oauth2_proxy_client_id: 8e5ced5b517a3b7a5edb
      oauth2_proxy_client_secret: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        65373239303938376365303536333332346332376462663032613837323731323966373639623830
        3934383862643634376637366433376336303936643330300a303635636666623636636262613736
        36373563373065316266346234303866343463333933353939633465356564613737643364363462
        3366663264623364310a633761333862333931326332613633323761623261363431343331656435
        38313735376632626133303031643466653164306631366338396163363065333364373237373533
        3164653531373834326139646166383232613565626261336137
      oauth2_proxy_gh_org: ringanta-demo-atlantis
      oauth2_proxy_gh_team: team-terraform
